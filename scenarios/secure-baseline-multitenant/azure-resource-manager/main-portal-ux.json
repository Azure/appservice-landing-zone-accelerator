{
    "$schema": "https://schema.management.azure.com/schemas/2021-09-09/uiFormDefinition.schema.json#",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "App Service LZA - Secure Baseline multitenant ",
            "steps": [
                {
                    "name": "basics",
                    "label": "Deployment settings",
                    "elements": [
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope"
                        },
                        {
                            "name": "getSubscriptions",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "POST",
                                "path": "providers/Microsoft.ResourceGraph/resources?api-version=2021-03-01",
                                "body": {
                                    "query": "ResourceContainers | where type =~ 'microsoft.resources/subscriptions' | where properties.state =~ 'enabled' | project label=tostring(name), description=subscriptionId, value=subscriptionId | order by label asc"
                                }
                            }
                        },
                        {
                            "name": "getLocations",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "GET",
                                "path": "locations?api-version=2019-11-01"
                            }
                        },
                        {
                            "name": "workloadName",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Workload Name",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "suffix (max 10 characters long) that will be used to name the resources in a pattern like <resourceAbbreviation>-<workloadName>",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": [
                                    {
                                        "isValid": "[or(or(empty(steps('basics').workloadName),and(not(startsWith(steps('basics').workloadName,'[[')),startsWith(steps('basics').workloadName,'['),endsWith(steps('basics').workloadName,']'),greater(indexOf(steps('basics').workloadName,'('),-1),greater(indexOf(steps('basics').workloadName,')'),-1))),lessOrEquals(length(steps('basics').workloadName),10))]",
                                        "message": "The value must have a length of at most 10."
                                    }
                                ]
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "environmentName",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Environment Name",
                            "subLabel": "",
                            "defaultValue": "test",
                            "toolTip": "Required. The name of the Environment Name (e.g. \"dev\", \"test\", \"prod\", \"preprod\", \"staging\", \"uat\", \"dr\", \"qa\"). Up to 8 characters long.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "dev",
                                        "value": "dev"
                                    },
                                    {
                                        "label": "dr",
                                        "value": "dr"
                                    },
                                    {
                                        "label": "preprod",
                                        "value": "preprod"
                                    },
                                    {
                                        "label": "prod",
                                        "value": "prod"
                                    },
                                    {
                                        "label": "qa",
                                        "value": "qa"
                                    },
                                    {
                                        "label": "staging",
                                        "value": "staging"
                                    },
                                    {
                                        "label": "test",
                                        "value": "test"
                                    },
                                    {
                                        "label": "uat",
                                        "value": "uat"
                                    }
                                ],
                                "required": true,
                                "validations": [
                                    {
                                        "isValid": "[or(or(empty(steps('basics').environmentName),and(not(startsWith(steps('basics').environmentName,'[[')),startsWith(steps('basics').environmentName,'['),endsWith(steps('basics').environmentName,']'),greater(indexOf(steps('basics').environmentName,'('),-1),greater(indexOf(steps('basics').environmentName,')'),-1))),lessOrEquals(length(steps('basics').environmentName),8))]",
                                        "message": "The value must have a length of at most 8."
                                    }
                                ]
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "appSvcPlanSection",
                            "type": "Microsoft.Common.Section",
                            "label": "App Service Plan settings",
                            "elements": [
                                {
                                    "name": "scenarioSelector",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "You can host your web applications in App Service Environment v3 (isolated hosting) or in an App Service Plan (multitenant hosting)",
                                        "link": {
                                            "label": "Learn more for App Service Environment v3",
                                            "uri": "https://learn.microsoft.com/azure/app-service/environment/overview"
                                        }
                                    }
                                },
                                {
                                    "name": "deployAseV3",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "label": "Deploy Isolated ASEv3?",
                                    "defaultValue": "No",
                                    "constraints": {
                                        "allowedValues": [                                            
                                            {
                                                "label": "No",
                                                "value": false
                                            },
                                            {
                                                "label": "Yes",
                                                "value": true
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "appSvcPlanSettings",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select one of the predefined SKUs for your App Service Plan, and the desired underlying OS (Linux or Windows). If you wish to deploy a Zone Redundant App Service, select one of the SKUs with the suffix _AZ.",
                                        "link": {
                                            "label": "Learn more for Availability Zones",
                                            "uri": "https://azure.github.io/AppService/2021/08/25/App-service-support-for-availability-zones.html"
                                        }
                                    }
                                },
                                {
                                    "name": "webAppPlanSku",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Web App Plan Sku",
                                    "subLabel": "",
                                    "defaultValue": "S1",
                                    "toolTip": "Defines the name, tier, size, family and capacity of the App Service Plan. Plans ending to _AZ, are deploying at least three instances in three Availability Zones. EP* is only for functions",
                                    "constraints": {
                                        "required": false,
                                        "allowedValues": [
                                            {
                                                "label": "S1",
                                                "value": "S1"
                                            },
                                            {
                                                "label": "S2",
                                                "value": "S2"
                                            },
                                            {
                                                "label": "S3",
                                                "value": "S3"
                                            },
                                            {
                                                "label": "P1V3",
                                                "value": "P1V3"
                                            },
                                            {
                                                "label": "P2V3",
                                                "value": "P2V3"
                                            },
                                            {
                                                "label": "P3V3",
                                                "value": "P3V3"
                                            },
                                            {
                                                "label": "P1V3_AZ",
                                                "value": "P1V3_AZ"
                                            },
                                            {
                                                "label": "P2V3_AZ",
                                                "value": "P2V3_AZ"
                                            },
                                            {
                                                "label": "P3V3_AZ",
                                                "value": "P3V3_AZ"
                                            }
                                        ],
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": "[equals(steps('basics').appSvcPlanSection.deployAseV3, false)]"
                                },
                                {
                                    "name": "webAppPlanSkuAse",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Web App Plan Sku (ASEv3)",
                                    "subLabel": "",
                                    "defaultValue": "ASE_I1V2_AZ",
                                    "toolTip": "Defines the name, tier, size, family and capacity of the App Service Plan. Plans ending to _AZ, are deploying at least three instances in three Availability Zones. EP* is only for functions",
                                    "constraints": {
                                        "required": false,
                                        "allowedValues": [                                            
                                            {
                                                "label": "ASE_I1V2_AZ",
                                                "value": "ASE_I1V2_AZ"
                                            },
                                            {
                                                "label": "ASE_I2V2_AZ",
                                                "value": "ASE_I2V2_AZ"
                                            },
                                            {
                                                "label": "ASE_I3V2_AZ",
                                                "value": "ASE_I3V2_AZ"
                                            },
                                            {
                                                "label": "ASE_I1V2",
                                                "value": "ASE_I1V2"
                                            },
                                            {
                                                "label": "ASE_I2V2",
                                                "value": "ASE_I2V2"
                                            },
                                            {
                                                "label": "ASE_I3V2",
                                                "value": "ASE_I3V2"
                                            }
                                        ],
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": "[equals(steps('basics').appSvcPlanSection.deployAseV3, true)]"
                                },
                                {
                                    "name": "webAppBaseOs",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Web App Base Os",
                                    "subLabel": "",
                                    "defaultValue": "Windows",
                                    "toolTip": "Kind of server OS of the App Service Plan",
                                    "constraints": {
                                        "required": false,
                                        "allowedValues": [
                                            {
                                                "label": "Windows",
                                                "value": "Windows"
                                            },
                                            {
                                                "label": "Linux",
                                                "value": "Linux"
                                            }
                                        ],
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": true
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "networking",
                    "label": "Network settings",
                    "elements": [
                        {
                            "name": "sectionHubSelector",
                            "type": "Microsoft.Common.Section",
                            "label": "Create a new Hub or use an existing one?",
                            "elements": [
                                {
                                    "name": "textHubSelector",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Do you want to deploy a new Hub (with all the necessary resources, i.e. Virtual Network, Azure Firewall, Azure Bastion etc), or do you prefer use an existing one? The existing hub must be in the same region, and have Azure Firewall, and Azure Bastion deployed in it.",
                                        "link": {
                                            "label": "More info for the Hub resources, at the Architecture Diagram",
                                            "uri": "https://github.com/thotheod/appservice-landing-zone-accelerator/tree/main/scenarios/secure-baseline-multitenant#architecture"
                                        }
                                    }
                                },
                                {
                                    "name": "deployHub",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "label": "Deploy a new Hub, or use an existing one?",
                                    "defaultValue": "New",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "New",
                                                "value": "deployNew"
                                            },
                                            {
                                                "label": "Existing",
                                                "value": "useExisting"
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "sectionHubNew",
                            "type": "Microsoft.Common.Section",
                            "label": "CIDR Settings for new Hub network and subnets",
                            "visible": "[equals(steps('networking').sectionHubSelector.deployHub, 'deployNew')]",
                            "elements": [
                                {
                                    "name": "textHubNew",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "You can accept the default address spaces, as shown below, or you can use your own.",
                                        "link": {
                                            "label": "What address ranges can I use in my Virtual Networks?",
                                            "uri": "https://learn.microsoft.com/azure/virtual-network/virtual-networks-faq#what-address-ranges-can-i-use-in-my-vnets"
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            "name": "vnetHubAddressSpace",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Hub Virtual Network Address Space",
                            "subLabel": "",
                            "defaultValue": "10.242.0.0/20",
                            "toolTip": "CIDR of the HUB vnet i.e. 192.168.0.0/24 - optional if you want to use an existing hub vnet (vnetHubResourceId)",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\/(1[0-9]|2[0-4]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [10,24]."
                                    }
                                ]
                            },
                            "infoMessages": [],
                            "visible": "[equals(steps('networking').sectionHubSelector.deployHub, 'deployNew')]"
                        },
                        {
                            "name": "subnetHubFirewallAddressSpace",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Hub Subnet CIDR for Azure Firewall",
                            "subLabel": "",
                            "defaultValue": "10.242.0.0/26",
                            "toolTip": "CIDR of the subnet hosting the azure Firewall - optional if you want to use an existing hub vnet (vnetHubResourceId)",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\/(2[0-6]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,26]."
                                    }
                                ]
                            },
                            "infoMessages": [],
                            "visible": "[equals(steps('networking').sectionHubSelector.deployHub, 'deployNew')]"
                        },
                        {
                            "name": "subnetHubBastionAddressSpace",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Hub Subnet CIDR for Bastion Service",
                            "subLabel": "",
                            "defaultValue": "10.242.0.64/26",
                            "toolTip": "CIDR of the subnet hosting the Bastion Service - optional if you want to use an existing hub vnet (vnetHubResourceId)",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\/(2[0-6]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,26]."
                                    }
                                ]
                            },
                            "infoMessages": [],
                            "visible": "[equals(steps('networking').sectionHubSelector.deployHub, 'deployNew')]"
                        },
                        {
                            "name": "sectionHubExisting",
                            "type": "Microsoft.Common.Section",
                            "label": "Information for the existing Hub resources",
                            "visible": "[equals(steps('networking').sectionHubSelector.deployHub, 'useExisting')]",
                            "elements": []
                        },
                        {
                            "name": "vnetHubResourceId",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Hub Vnet Resource Id",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "Default is empty. If empty, then a new hub will be created. If given, no new hub will be created and we create the  peering between spoke and and existing hub vnet",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": "[equals(steps('networking').sectionHubSelector.deployHub, 'useExisting')]"
                        },
                        {
                            "name": "firewallInternalIp",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Firewall Internal IP",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "Internal IP of the Azure firewall deployed in Hub. Used for creating UDR to route all vnet egress traffic through Firewall. If empty no UDR",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": "[equals(steps('networking').sectionHubSelector.deployHub, 'useExisting')]"
                        },
                        {
                            "name": "sectionSpoke",
                            "type": "Microsoft.Common.Section",
                            "label": "CIDR Settings for the Spoke network and subnets",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "textSpoke",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "You can accept the default address spaces, as shown below, or you can use your own.",
                                        "link": {
                                            "label": "What address ranges can I use in my Virtual Networks?",
                                            "uri": "https://learn.microsoft.com/azure/virtual-network/virtual-networks-faq#what-address-ranges-can-i-use-in-my-vnets"
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            "name": "vnetSpokeAddressSpace",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Spoke Virtual Network Address Space",
                            "subLabel": "",
                            "defaultValue": "10.240.0.0/20",
                            "toolTip": "CIDR of the SPOKE vnet i.e. 192.168.0.0/24",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\/(1[0-9]|2[0-4]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [10,24]."
                                    }
                                ]
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "subnetSpokeAppSvcAddressSpaceAse",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Spoke Subnet CIDR for Azure App Service",
                            "subLabel": "",
                            "defaultValue": "10.240.0.0/24",
                            "toolTip": "CIDR of the subnet that will hold the app services plan. Use a /24 network space if you wish to deploy ASEv3, otherwise use a /26 for multi tenant app service plan.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\/(2[0-6]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,26]."
                                    }
                                ]
                            },
                            "infoMessages": [],
                            "visible": "[equals(steps('basics').appSvcPlanSection.deployAseV3, true)]"
                        },
                        {
                            "name": "subnetSpokeAppSvcAddressSpace",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Spoke Subnet CIDR for Azure App Service",
                            "subLabel": "",
                            "defaultValue": "10.240.0.0/26",
                            "toolTip": "CIDR of the subnet that will hold the app services plan. Use a /24 network space if you wish to deploy ASEv3, otherwise use a /26 for multi tenant app service plan.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\/(2[0-6]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,26]."
                                    }
                                ]
                            },
                            "infoMessages": [],
                            "visible": "[equals(steps('basics').appSvcPlanSection.deployAseV3, false)]"
                        },
                        {
                            "name": "subnetSpokeDevOpsAddressSpace",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Spoke Subnet CIDR for Dev Ops agent (VM)",
                            "subLabel": "",
                            "defaultValue": "10.240.10.128/26",
                            "toolTip": "CIDR of the subnet that will hold devOps agents etc ",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\/(2[0-6]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,26]."
                                    }
                                ]
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "subnetSpokePrivateEndpointAddressSpace",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Spoke Subnet CIDR for Azure Private Endpoints",
                            "subLabel": "",
                            "defaultValue": "10.240.11.0/24",
                            "toolTip": "CIDR of the subnet that will hold the private endpoints of the supporting services",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\/(2[0-6]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,26]."
                                    }
                                ]
                            },
                            "infoMessages": [],
                            "visible": true
                        }
                    ]
                },
                {
                    "name": "extra",
                    "label": "Jump-Box settings (VM)",
                    "elements": [
                        {
                            "name": "location",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Location",
                            "subLabel": "",
                            "defaultValue": "[steps('basics').resourceScope.location.displayName]",
                            "toolTip": "Azure region where the resources will be deployed in",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": false
                        },
                        {
                            "name": "numericSuffix",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Numeric Suffix",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "Optional. A numeric suffix (e.g. \"001\") to be appended on the naming generated for the resources. Defaults to empty.",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": false
                        },
                        {
                            "name": "jumpBoxSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Jump-box Virtual Machine/DevOps agent settings",
                            "elements": [
                                {
                                    "name": "deployJumpHost",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Deploy Jump Box?",
                                    "subLabel": "",
                                    "defaultValue": "Yes",
                                    "toolTip": "set to true if you want to deploy a jumpbox/devops VM",
                                    "constraints": {
                                        "required": false,
                                        "allowedValues": [
                                            {
                                                "label": "Yes",
                                                "value": true
                                            },
                                            {
                                                "label": "No",
                                                "value": false
                                            }
                                        ],
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": true
                                },
                                {
                                    "name": "windowsVmCredentials",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": "[equals(steps('extra').jumpBoxSection.deployJumpHost, true)]",
                                    "options": {
                                        "text": "Give the CredentialsCombo for your windows Jump-box. The VM will be AAD Joined, so you can use your AAD credentials to login. The password must contain at least 12 characters, with at least 1 uppercase, 1 lowercase and 1 number.",
                                        "link": {
                                            "label": "Learn more for Windows VM Password Policy",
                                            "uri": "https://learn.microsoft.com/en-us/azure/virtual-machines/windows/faq#what-are-the-password-requirements-when-creating-a-vm-"
                                        }
                                    }
                                },
                                {
                                    "name": "adminUsername",
                                    "type": "Microsoft.Compute.UserNameTextBox",
                                    "label": "Admin Username",
                                    "defaultValue": "azureuser",
                                    "toolTip": "",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z]{8,15}$",
                                        "validationMessage": "Only alphanumeric characters are allowed, and the value must be 8-15 characters long."
                                    },
                                    "osPlatform": "Windows",
                                    "visible": "[equals(steps('extra').jumpBoxSection.deployJumpHost, true)]"
                                },
                                {
                                    "name": "vmCredentials",
                                    "type": "Microsoft.Compute.CredentialsCombo",
                                    "label": {
                                        "password": "Password",
                                        "confirmPassword": "Confirm password"
                                    },
                                    "toolTip": {
                                        "password": ""
                                    },
                                    "constraints": {
                                        "required": true,
                                        "customPasswordRegex": "^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])[\\w~@#$%^&*+=|{}:;!.?\\()\\[\\]-]{12,}$",
                                        "customValidationMessage": "The password must contain at least 12 characters, with at least 1 uppercase, 1 lowercase and 1 number."
                                    },
                                    "options": {
                                        "hideConfirmation": false
                                    },
                                    "osPlatform": "Windows",
                                    "visible": "[equals(steps('extra').jumpBoxSection.deployJumpHost, true)]"
                                }
                            ]
                        },                           
                        {
                            "name": "sectionAdditionalTools",
                            "type": "Microsoft.Common.Section",
                            "label": "Post-Deployment installation of additional tools",
                            "visible": "[equals(steps('extra').jumpBoxSection.deployJumpHost, true)]",
                            "elements": [
                                {
                                    "name": "txtBlockPostDeploymentInfo",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": "[equals(steps('extra').jumpBoxSection.deployJumpHost, true)]",
                                    "options": {
                                        "text": "Below you can select if you wish to deploy some additional tools on the jump-box VM, i.e. azure cli, azure developer cli, git, sql server management studio. Have in mind that the more the tools you select, the more time it will take for the deployment to complete."
                                    }
                                },
                                {
                                    "name": "deployClis",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Install useful CLIs (Azure, AZD, and Git)?",
                                    "subLabel": "",
                                    "defaultValue": "No",
                                    "toolTip": "set to true if you want to install CLIs on the jump-box VM",
                                    "constraints": {
                                        "required": false,
                                        "allowedValues": [
                                            {
                                                "label": "Yes",
                                                "value": true
                                            },
                                            {
                                                "label": "No",
                                                "value": false
                                            }
                                        ],
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": "[equals(steps('extra').jumpBoxSection.deployJumpHost, true)]"
                                },
                                {
                                    "name": "deploySsms",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "install Sql Server Management Studio (SSMS)?",
                                    "subLabel": "",
                                    "defaultValue": "No",
                                    "toolTip": "set to true if you want install Sql Server Management Studio (SSMS) on the jump-box VM",
                                    "constraints": {
                                        "required": false,
                                        "allowedValues": [
                                            {
                                                "label": "Yes",
                                                "value": true
                                            },
                                            {
                                                "label": "No",
                                                "value": false
                                            }
                                        ],
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": "[equals(steps('extra').jumpBoxSection.deployJumpHost, true)]"
                                }
                            ]
                        },
                        {
                            "name": "jumpBoxGithubRunnerSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Jump-box GitHub Runner Settings",
                            "elements": [
                                {
                                    "name": "deployGitHubRunner",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Install Github Runner?",
                                    "subLabel": "",
                                    "defaultValue": "No",
                                    "toolTip": "set to true if you want to deploy selft hosted GitHub Actions runner",
                                    "constraints": {
                                        "required": false,
                                        "allowedValues": [
                                            {
                                                "label": "Yes",
                                                "value": true
                                            },
                                            {
                                                "label": "No",
                                                "value": false
                                            }
                                        ],
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": true
                                },
                                {
                                    "name": "githubRepositoryUrl",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "GitHub Repository URL",
                                    "defaultValue": "",
                                    "toolTip": "The URL of the Github repository to use for the Github Actions Runner. If this parameter is provided, then github_token must also be provided.",
                                    "constraints": {
                                        "required": false,
                                        "regex": "",
                                        "validationMessage": "",
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": "[equals(steps('extra').jumpBoxGithubRunnerSection.deployGitHubRunner, true)]"
                                },
                                {
                                    "name": "githubToken",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "GitHub Token",
                                    "defaultValue": "",
                                    "toolTip": "The GitHub token to use for the Github Actions Runner. If this parameter is provided, then github_repository_url must also be provided.",
                                    "constraints": {
                                        "required": false,
                                        "regex": "",
                                        "validationMessage": "",
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": "[equals(steps('extra').jumpBoxGithubRunnerSection.deployGitHubRunner, true)]"
                                }
                            ],
                            "visible": "[equals(steps('extra').jumpBoxSection.deployJumpHost, true)]"
                        },
                        {
                            "name": "jumpBoxAzDoAgentSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Azure DevOps Self Hosted Agent Settings",
                            "elements": [
                                {
                                    "name": "deployAzDoSelfHostedAgent",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Install Azure DevOps Self Hosted Agent?",
                                    "subLabel": "",
                                    "defaultValue": "No",
                                    "toolTip": "set to true if you want to deploy self hosted agent for Azure DevOps",
                                    "constraints": {
                                        "required": false,
                                        "allowedValues": [
                                            {
                                                "label": "Yes",
                                                "value": true
                                            },
                                            {
                                                "label": "No",
                                                "value": false
                                            }
                                        ],
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": true
                                },
                                {
                                    "name": "adoOrganization",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "URL of the Azure DevOps organization",
                                    "defaultValue": "",
                                    "toolTip": "The URL of the Azure DevOps organization to use for the Azure DevOps Agent. If this parameter is provided, then ado_token must also be provided",
                                    "constraints": {
                                        "required": false,
                                        "regex": "",
                                        "validationMessage": "",
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": "[equals(steps('extra').jumpBoxAzDoAgentSection.deployAzDoSelfHostedAgent, true)]"
                                },
                                {
                                    "name": "adoToken",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Azure DevOps Token",
                                    "defaultValue": "",
                                    "toolTip": "The Azure DevOps token to use for the Azure DevOps Agent. If this parameter is provided, then ado_organization must also be provided.",
                                    "constraints": {
                                        "required": false,
                                        "regex": "",
                                        "validationMessage": "",
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": "[equals(steps('extra').jumpBoxAzDoAgentSection.deployAzDoSelfHostedAgent, true)]"
                                }
                            ],
                            "visible": "[equals(steps('extra').jumpBoxSection.deployJumpHost, true)]"
                        }
                    ]
                },
                {
                    "name": "SQL",
                    "label": "Azure SQL settings",
                    "elements": [
                        {
                            "name": "sqlServerIntroSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Azure SQL Server deployment feature flag",
                            "elements": [
                                {
                                    "name": "sqlServerIntro",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select if you wish to deploy an Azure SQL Server with a default database. This will require more time in the deployment."
                                    }
                                },
                                {
                                    "name": "deployAzureSql",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Deploy Azure Sql Server?",
                                    "subLabel": "",
                                    "defaultValue": "No",
                                    "toolTip": "Set to true if you want to deploy a azure SQL server and default database",
                                    "constraints": {
                                        "required": false,
                                        "allowedValues": [
                                            {
                                                "label": "Yes",
                                                "value": true
                                            },
                                            {
                                                "label": "No",
                                                "value": false
                                            }
                                        ],
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": true
                                }
                            ]
                        },
                        {
                            "name": "sqlServerDeploySection",
                            "type": "Microsoft.Common.Section",
                            "label": "SQL Server settings",
                            "visible": "[equals(steps('SQL').sqlServerIntroSection.deployAzureSql, true)]",
                            "elements": [
                                {
                                    "name": "sqlServerAuthentication",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the authentication method for the SQL Server administrator. Azure AD for SQL Server administrator authentication is suggested."
                                    }
                                },
                                {
                                    "name": "azureSqlAuthentication",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Azure Sql Server Authentication",
                                    "subLabel": "",
                                    "defaultValue": "Azure AD",
                                    "toolTip": "Select Azure AD for SQL Server administrator authentication for better security and passwordless access. If you select SQL Server local user, you will need to provide a password for the SQL Server administrator.",
                                    "constraints": {
                                        "required": false,
                                        "allowedValues": [
                                            {
                                                "label": "Azure AD",
                                                "value": "AAD"
                                            },
                                            {
                                                "label": "SQL Server local user",
                                                "value": "local"
                                            }
                                        ],
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": true
                                },
                                {
                                    "name": "sqlServerAdministratorsExplanation",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": "[equals(steps('SQL').sqlServerDeploySection.azureSqlAuthentication, 'AAD')]",
                                    "options": {
                                        "text": "Replace AAD_SQL_ADMIN_GROUP with Azure AD group where your Azure administrators are members, sid value (xxxx-xxxx-xxxx-xxxx-xxxx) with Azure AD object ID of that group. The current tenantId value is already filled in."
                                    }
                                },
                                {
                                    "name": "sqlServerAdministrators",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Sql Server Administrators",
                                    "subLabel": "",
                                    "defaultValue": "[concat('{\n\t\"login\": \"AAD_SQL_ADMIN_GROUP\",\n\t\"sid\": \"xxxx-xxxx-xxxx-xxxx-xxxx\",\n\t\"tenantId\": \"', steps('basics').resourceScope.subscription.tenantId, '\"\n}')]",
                                    "multiLine": true,
                                    "toolTip": "Replace AAD_SQL_ADMIN_GROUP with Azure AD group where your Azure administrators are members, sid value with Azure AD object ID of that group and tenantId value with Azure AD tenant ID where the group is located",
                                    "constraints": {
                                        "required": false,
                                        "regex": "",
                                        "validationMessage": "",
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": "[equals(steps('SQL').sqlServerDeploySection.azureSqlAuthentication, 'AAD')]"
                                },
                                {
                                    "name": "sqlAdminLogin",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Sql Admin Login",
                                    "subLabel": "",
                                    "defaultValue": "sqluser",
                                    "toolTip": "Conditional. If sqlServerAdministrators is given, this is not required. ",
                                    "constraints": {
                                        "required": false,
                                        "regex": "",
                                        "validationMessage": "",
                                        "validations": []
                                    },
                                    "infoMessages": [],
                                    "visible": "[equals(steps('SQL').sqlServerDeploySection.azureSqlAuthentication, 'local')]"
                                },
                                {
                                    "name": "sqlAdminPassword",
                                    "type": "Microsoft.Common.PasswordBox",
                                    "label": {
                                        "password": "Sql Admin Password",
                                        "confirmPassword": "Confirm password"
                                    },
                                    "defaultValue": "[newGuid()]",
                                    "toolTip": "Conditional. If sqlServerAdministrators is given, this is not required -check password policy: https://learn.microsoft.com/en-us/sql/relational-databases/security/password-policy?view=azuresqldb-current",
                                    "constraints": {
                                        "required": false,
                                        "regex": "",
                                        "validationMessage": "",
                                        "validations": []
                                    },
                                    "options": {
                                        "hideConfirmation": true
                                    },
                                    "visible": "[equals(steps('SQL').sqlServerDeploySection.azureSqlAuthentication, 'local')]"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "flags",
                    "label": "Deployment feature flags",
                    "elements": [
                        {
                            "name": "enableEgressLockdown",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Enable Egress Lockdown",
                            "subLabel": "",
                            "defaultValue": "false",
                            "toolTip": "set to true if you want to intercept all outbound traffic with azure firewall",
                            "constraints": {
                                "required": false,
                                "allowedValues": [
                                    {
                                        "label": "true",
                                        "value": true
                                    },
                                    {
                                        "label": "false",
                                        "value": false
                                    }
                                ],
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "deployRedis",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Deploy Redis",
                            "subLabel": "",
                            "defaultValue": "false",
                            "toolTip": "set to true if you want to deploy a redis cache",
                            "constraints": {
                                "required": false,
                                "allowedValues": [
                                    {
                                        "label": "true",
                                        "value": true
                                    },
                                    {
                                        "label": "false",
                                        "value": false
                                    }
                                ],
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "deployAppConfig",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Deploy App Config",
                            "subLabel": "",
                            "defaultValue": "false",
                            "toolTip": "set to true if you want to deploy application configuration",
                            "constraints": {
                                "required": false,
                                "allowedValues": [
                                    {
                                        "label": "true",
                                        "value": true
                                    },
                                    {
                                        "label": "false",
                                        "value": false
                                    }
                                ],
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "autoApproveAfdPrivateEndpoint",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Auto Approve Afd Private Endpoint",
                            "subLabel": "",
                            "defaultValue": "true",
                            "toolTip": "set to true if you want to auto approve the Private Endpoint of the AFD",
                            "constraints": {
                                "required": false,
                                "allowedValues": [
                                    {
                                        "label": "true",
                                        "value": true
                                    },
                                    {
                                        "label": "false",
                                        "value": false
                                    }
                                ],
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        }, 
                        {
                            "name": "openAiInfoTitle",
                            "type": "Microsoft.Common.Section",
                            "label": "Azure OpenAI Feature Flag",
                            "elements": []
                        },
                        {
                            "name": "openAiInfo",
                            "type": "Microsoft.Common.TextBlock",
                            "visible": true,
                            "options": {
                                "text": "Please be informed that currently Azure OpenAI is in preview and only available in limited regions. Also your azure subscription needs to be allow-listed.",
                                "link": {
                                    "label": "Azure OpenAI Prerequisites",
                                    "uri": "https://learn.microsoft.com/azure/ai-services/openai/chatgpt-quickstart#prerequisites"
                                }
                            }
                        },
                        {
                            "name": "deployOpenAI",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Deploy OpenAI",
                            "subLabel": "what is that??",
                            "defaultValue": "false",
                            "toolTip": "set to true if you want to deploy OpenAI",
                            "constraints": {
                                "required": false,
                                "allowedValues": [
                                    {
                                        "label": "true",
                                        "value": true
                                    },
                                    {
                                        "label": "false",
                                        "value": false
                                    }
                                ],
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "parameters": {
                "workloadName": "[steps('basics').workloadName]",
                "location": "[steps('extra').location]",
                "environmentName": "[steps('basics').environmentName]",
                "vnetHubAddressSpace": "[steps('networking').vnetHubAddressSpace]",
                "subnetHubFirewallAddressSpace": "[steps('networking').subnetHubFirewallAddressSpace]",
                "subnetHubBastionAddressSpace": "[steps('networking').subnetHubBastionAddressSpace]",
                "vnetSpokeAddressSpace": "[steps('networking').vnetSpokeAddressSpace]",
                "subnetSpokeAppSvcAddressSpace": "[if( equals ( steps('basics').appSvcPlanSection.deployAseV3, true), steps('networking').subnetSpokeAppSvcAddressSpaceAse , steps('networking').subnetSpokeAppSvcAddressSpace )]",
                "subnetSpokeDevOpsAddressSpace": "[steps('networking').subnetSpokeDevOpsAddressSpace]",
                "subnetSpokePrivateEndpointAddressSpace": "[steps('networking').subnetSpokePrivateEndpointAddressSpace]",
                "numericSuffix": "[steps('extra').numericSuffix]",
                "vnetHubResourceId": "[steps('networking').vnetHubResourceId]",
                "firewallInternalIp": "[steps('networking').firewallInternalIp]",
                "deployAseV3": "[steps('basics').appSvcPlanSection.deployAseV3]",
                "webAppPlanSku": "[if( equals ( steps('basics').appSvcPlanSection.deployAseV3, true), steps('basics').appSvcPlanSection.webAppPlanSkuAse , steps('basics').appSvcPlanSection.webAppPlanSku )]",
                "webAppBaseOs": "[steps('basics').appSvcPlanSection.webAppBaseOs]",
                "adminUsername": "[steps('extra').jumpBoxSection.adminUsername]",
                "adminPassword": "[if( equals ( steps('extra').jumpBoxSection.deployJumpHost, true), steps('extra').jumpBoxSection.vmCredentials.password , 'Pass@word123$' )]",
                "sqlServerAdministrators": "[steps('SQL').sqlServerDeploySection.sqlServerAdministrators]",
                "sqlAdminLogin": "[steps('SQL').sqlServerDeploySection.sqlAdminLogin]",
                "sqlAdminPassword": "[steps('SQL').sqlServerDeploySection.sqlAdminPassword]",
                "deployAzureSql": "[steps('SQL').sqlServerIntroSection.deployAzureSql]",
                "deployJumpHost": "[steps('extra').jumpBoxSection.deployJumpHost]",
                "enableEgressLockdown": "[steps('flags').enableEgressLockdown]",
                "deployRedis": "[steps('flags').deployRedis]",
                "deployAppConfig": "[steps('flags').deployAppConfig]",
                "autoApproveAfdPrivateEndpoint": "[steps('flags').autoApproveAfdPrivateEndpoint]",
                "deployOpenAI": "[steps('flags').deployOpenAI]",
                "githubRepository": "[if( equals ( steps('extra').jumpBoxGithubRunnerSection.deployGitHubRunner, true), steps('extra').jumpBoxGithubRunnerSection.githubRepositoryUrl , '' )]",
                "githubToken": "[if( equals ( steps('extra').jumpBoxGithubRunnerSection.deployGitHubRunner, true), steps('extra').jumpBoxGithubRunnerSection.githubToken , '' )]",
                "adoOrganization": "[if( equals ( steps('extra').jumpBoxAzDoAgentSection.deployAzDoSelfHostedAgent, true), steps('extra').jumpBoxAzDoAgentSection.adoOrganization , '' )]",
                "adoToken": "[if( equals ( steps('extra').jumpBoxAzDoAgentSection.deployAzDoSelfHostedAgent, true), steps('extra').jumpBoxAzDoAgentSection.adoToken , '' )]",
                "installClis": "[steps('extra').sectionAdditionalTools.deployClis]",
                "installSsms": "[steps('extra').sectionAdditionalTools.deploySsms]"

                
                
            },
            "kind": "Subscription",
            "location": "[steps('basics').resourceScope.location.name]",
            "subscriptionId": "[steps('basics').resourceScope.subscription.id]"
        }
    }
}